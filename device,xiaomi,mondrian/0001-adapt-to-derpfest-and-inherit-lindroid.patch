From ddae13bb73c9ebc0aa81feb96b049510271e0f8e Mon Sep 17 00:00:00 2001
From: Hecheng Yu <kde-yyds@qq.com>
Date: Fri, 29 Nov 2024 15:22:34 +0800
Subject: [PATCH] adapt to derpfest and inherit lindroid

---
 AndroidProducts.mk | 10 +++++-----
 BoardConfig.mk     |  2 +-
 derp_mondrian.mk   | 31 +++++++++++++++++++++++++++++++
 device.mk          |  2 +-
 4 files changed, 38 insertions(+), 7 deletions(-)
 create mode 100644 derp_mondrian.mk

diff --git a/AndroidProducts.mk b/AndroidProducts.mk
index ff75e87..c0e82cb 100644
--- a/AndroidProducts.mk
+++ b/AndroidProducts.mk
@@ -5,9 +5,9 @@
 #
 
 PRODUCT_MAKEFILES := \
-    $(LOCAL_DIR)/lineage_mondrian.mk
+    $(LOCAL_DIR)/derp_mondrian.mk
 
-COMMON_LUNCH_CHOICES := \
-    lineage_mondrian-user \
-    lineage_mondrian-userdebug \
-    lineage_mondrian-eng
\ No newline at end of file
+#COMMON_LUNCH_CHOICES := \
+#    lineage_mondrian-user \
+#    lineage_mondrian-userdebug \
+#    lineage_mondrian-eng
diff --git a/BoardConfig.mk b/BoardConfig.mk
index b4c5528..2652763 100644
--- a/BoardConfig.mk
+++ b/BoardConfig.mk
@@ -108,7 +108,7 @@ DEVICE_MANIFEST_TARO_FILES := $(DEVICE_MANIFEST_CAPE_FILES)
 DEVICE_FRAMEWORK_COMPATIBILITY_MATRIX_FILE := \
     $(DEVICE_PATH)/configs/vintf/vendor_framework_compatibility_matrix.xml \
     $(DEVICE_PATH)/configs/vintf/xiaomi_framework_compatibility_matrix.xml \
-    vendor/lineage/config/device_framework_matrix.xml
+    vendor/derp/config/device_framework_matrix.xml
 
 DEVICE_FRAMEWORK_MANIFEST_FILE += $(DEVICE_PATH)/configs/vintf/framework_manifest.xml
 
diff --git a/derp_mondrian.mk b/derp_mondrian.mk
new file mode 100644
index 0000000..8892f9e
--- /dev/null
+++ b/derp_mondrian.mk
@@ -0,0 +1,31 @@
+#
+# Copyright (C) 2024 The LineageOS Project
+#
+# SPDX-License-Identifier: Apache-2.0
+#
+
+# Inherit from mondrian device
+$(call inherit-product, device/xiaomi/mondrian/device.mk)
+
+# Inherit from common lineage configuration
+TARGET_DISABLE_EPPE := true
+$(call inherit-product, vendor/derp/config/common_full_phone.mk)
+
+PRODUCT_NAME := derp_mondrian
+PRODUCT_DEVICE := mondrian
+PRODUCT_MANUFACTURER := Xiaomi
+
+PRODUCT_SYSTEM_NAME := mondrian_global
+PRODUCT_SYSTEM_DEVICE := mondrian
+
+PRODUCT_GMS_CLIENTID_BASE := android-xiaomi
+
+PRODUCT_BUILD_PROP_OVERRIDES += \
+    BuildDesc="mondrian_global-user 12 SKQ1.230401.001 V816.0.10.0.UMNMIXM release-keys" \
+    BuildFingerprint=POCO/mondrian_global/mondrian:12/SKQ1.230401.001/V816.0.10.0.UMNMIXM:user/release-keys \
+    DeviceProduct=$(PRODUCT_DEVICE)
+
+TARGET_BOOT_ANIMATION_RES := 1440
+
+WITH_GMS := true
+TARGET_HAS_UDFPS := true
diff --git a/device.mk b/device.mk
index 16b2d2d..cdb8133 100644
--- a/device.mk
+++ b/device.mk
@@ -25,7 +25,7 @@ $(call inherit-product, frameworks/native/build/phone-xhdpi-6144-dalvik-heap.mk)
 
 # Inherit from the proprietary version
 $(call inherit-product, vendor/xiaomi/mondrian/mondrian-vendor.mk)
-
+$(call inherit-product, vendor/lindroid/lindroid.mk)
 # Platform
 TARGET_BOARD_PLATFORM := taro
 
-- 
2.39.2

